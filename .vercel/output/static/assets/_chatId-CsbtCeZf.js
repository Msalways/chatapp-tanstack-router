import{h as w,i as S,s as $,j as e,r as i,k as E,l as z,R as D,g as R,t as v}from"./index-Do_QRU06.js";import{c as f}from"./createLucideIcon-DDSZfW1L.js";import{B as q}from"./button-DxNiDPsM.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],y=f("bot",L);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],K=f("send",T);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],A=f("user",_),I=a=>{const s=w();return S({mutationFn:async l=>await $(a,l),onSuccess:()=>{s.invalidateQueries({queryKey:["listChatMessages",a]})}})};function F({role:a,content:s,timestamp:l}){const t=a==="user"||a==="User";return e.jsxs("div",{className:`flex gap-3 p-4 ${t?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${t?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 border"}`,children:t?e.jsx(A,{size:16}):e.jsx(y,{size:16})}),e.jsxs("div",{className:`flex flex-col max-w-[70%] ${t?"items-end":"items-start"}`,children:[e.jsx("div",{className:`px-4 py-2 rounded-2xl ${t?"bg-blue-500 text-white rounded-br-md":"bg-gray-100 text-gray-900 rounded-bl-md"}`,children:e.jsx("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed",children:s})}),l&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 px-2",children:new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}function Q({onSend:a,disabled:s=!1,placeholder:l="Type your message..."}){const[t,d]=i.useState(""),x=i.useRef(null),c=()=>{!t.trim()||s||(a(t.trim()),d(""))},m=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),c())};return i.useEffect(()=>{const r=x.current;r&&(r.style.height="auto",r.style.height=Math.min(r.scrollHeight,120)+"px")},[t]),e.jsx("div",{className:"p-4 border-t bg-white",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex items-end gap-3 bg-gray-50 rounded-xl p-2",children:[e.jsx("textarea",{ref:x,value:t,onChange:r=>d(r.target.value),onKeyDown:m,placeholder:l,disabled:s,className:"flex-1 resize-none bg-transparent border-0 outline-none p-2 text-sm placeholder-gray-500 max-h-[120px] overflow-y-auto",rows:1}),e.jsx(q,{onClick:c,disabled:s||!t.trim(),className:`p-2 rounded-lg transition-colors ${s||!t.trim()?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600 active:bg-blue-700"}`,children:e.jsx(K,{size:16})})]})})})}const B=a=>(console.log(a),E({queryKey:["listChatMessages",a],queryFn:async()=>{const s=await z(a);return console.log("Response",s),s},enabled:!!a,retry:!1,gcTime:0,refetchOnMount:!0,refetchOnWindowFocus:!1,networkMode:"always"})),O=function(){const{chatId:s}=D.useParams(),{setSelectedChatId:l,chats:t}=R(),[d,x]=i.useState(""),c=w(),[m,r]=i.useState(!1),{data:h=[],isLoading:M,error:p,refetch:j}=B(s);i.useEffect(()=>{var n;s&&(l(s),x(((n=t.find(o=>o.id===s))==null?void 0:n.name)??""))},[s,l,c]);const u=I(s),C=async n=>{if(!s){v("No chat selected");return}try{r(!0),await u.mutateAsync(n),console.log("Message sent successfully, clearing cache and refetching"),c.removeQueries({queryKey:["listChatMessages",s]}),setTimeout(()=>{j()},100)}catch(o){v.error("Failed to send message"),console.error("Send message error:",o)}finally{r(!1)}},b=M,k=!!p||u.isError,g=p||u.error,N=u.isPending;return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("h2",{className:"font-semibold text-gray-900",children:["Chat:- ",d||s.slice(0,8)]}),e.jsx("p",{className:"text-sm text-gray-500",children:"AI Assistant"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[b&&e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-sm text-gray-500",children:["Loading messages for chat ",s,"..."]})}),k&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-red-600",children:["Error loading messages: ",g==null?void 0:g.message]}),e.jsx("button",{onClick:()=>j(),className:"mt-2 text-xs bg-red-100 px-2 py-1 rounded",children:"Retry"})]})}),!b&&h.length===0&&e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Start a conversation"}),e.jsx("p",{className:"text-sm",children:"Send a message to begin chatting with the AI assistant."}),e.jsxs("p",{className:"text-xs mt-2 text-gray-400",children:["Chat ID: ",s]})]})}),h.length>0&&e.jsxs("div",{className:"py-4",children:[h.map((n,o)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("div",{className:"text-xs text-gray-400 px-4",children:["Msg ID: ",n.id," | Chat: ",s]}),e.jsx(F,{role:n.role,content:n.message,timestamp:n.createdAt})]},`${s}-${n.id}-${o}`)),(m||N)&&e.jsxs("div",{className:"flex gap-3 p-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center border",children:e.jsx(y,{size:16,className:"text-gray-600"})}),e.jsx("div",{className:"bg-gray-100 rounded-2xl rounded-bl-md px-4 py-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})]})]})}),e.jsx(Q,{onSend:C,disabled:N||m,placeholder:`Type your message for chat ${s.slice(0,8)}...`})]})};export{O as component};
